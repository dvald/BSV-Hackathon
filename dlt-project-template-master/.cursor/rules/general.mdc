# General Project Rules

This document provides the general development rules that must be followed throughout the project to maintain code consistency and quality.

## Language Policy

- **Response Language:** Always respond in the same language the user asks the question
- **Documentation Language:** If user asks in Spanish for documentation in English, provide it in English as requested
- **Code Consistency:** Code comments should be in English to maintain consistency across the project

## 1. General Development Rules

- **Code Cleanliness:** Do not include icons, emojis, or emoticons in code comments, test descriptions, commit messages, or log messages.
- **Centralized Logging (Backend):** Do not use `console.log` for logging in the backend. All server-side logs must be routed through the centralized `Monitor` class located at `web-application/backend/src/monitor.ts`.
- **API Documentation for Code Generation:**
  - **Generator Script:** The entire API client layer—including TypeScript definitions and calling functions—is generated by the `web-application/backend/scripts/gen-api-bindings.js` script. **Do not modify generated files manually.**
  - **Required Action:** To add or modify an API endpoint, you must document it with a specific JSDoc format above the controller function in its corresponding file within `web-application/backend/src/controllers/api/`.
- **Centralized Error Handling (Backend):** Use the utility functions `sendError` and `sendSuccess` from `web-application/backend/src/utils/http-utils.ts` to format all API responses.
- **Follow Naming Conventions:** Adhere strictly to the naming conventions for files, classes, functions, and variables.

## 2. Tech Stack

### Frontend (`web-application/frontend`)
- **Framework:** Vue.js 3
- **Language:** TypeScript
- **Router:** Vue Router
- **State Management:** Vue 3 Composition API (without Vuex/Pinia)
- **Internationalization:** vue-i18n
- **Build Tool:** Vite
- **Styling:** Plain CSS with CSS variables for theming

### Backend (`web-application/backend`)
- **Framework:** Express.js
- **Language:** TypeScript
- **ORM:** tsbean-orm (multi-database)
- **Cache/Messaging:** Redis
- **Blockchain Interaction:** Ethers.js and @asanrom/smart-contract-wrapper
- **Authentication:** Database-backed session tokens
- **Email:** Nodemailer

### Smart Contracts (`smart-contracts`)
- **Language:** Solidity
- **Framework:** Hardhat
- **Libraries:** Ethers.js, TypeChain, @asanrom/smart-contract-wrapper

### Mobile Application (`mobile-application`)
- **Framework:** React Native with Expo
- **Language:** TypeScript/TSX
- **Navigation:** React Navigation

## 3. Code Conventions

### File Naming
- `kebab-case` for most files
- **Examples:** `api-group-account.ts`, `main-layout.css`, `users-service.ts`
- Vue components use `PascalCase`
- **Example:** `HomePage.vue`, `ModalDialogContainer.vue`

### Class, Function, and Variable Naming
- **Classes:** `PascalCase` - Example: `class UsersService`, `class Monitor`
- **Functions and Methods:** `camelCase` - Example: `async function getUserProfile()`, `sendError()`
- **Constants:** `UPPER_SNAKE_CASE` - Example: `const MONGO_DB_URL`
- **Interfaces (TypeScript):** `PascalCase` without prefixes like `I` - Example: `interface UserProfile`

### Code Formatting
- **Imports:** Grouped by origin (external libraries, project aliases)
- **Spacing:** 4 spaces for indentation in backend, 2 spaces in frontend
- **Line Length:** Generally kept under 120 characters
- **Trailing Commas:** Used at the end of multiline object property lists and arrays
- **Semicolons:** Used at the end of each statement in TypeScript

## 4. Logging

- **Centralization:** All **backend** logging logic must go through the `Monitor` class located at `web-application/backend/src/monitor.ts`
- **Log Levels:**
  - `debug`: For detailed information useful during development
  - `info`: For important application flow events
  - `warn`: For unexpected but non-critical situations
  - `error`: For captured errors that prevent an operation from completing
- **Standard Format:** `[YYYY-MM-DD HH:mm:ss.SSS] [LEVEL] [TAG] Message`

## 5. Error Handling

### Error Capturing (Backend)
- **Controllers:** Use `try/catch` blocks within controller functions
- **Global Middleware:** Configured in `web-application/backend/src/app.ts` as the last `app.use()`
- **Request Errors:** Use validators to verify `body`, `query`, and `params`

### Canonical Error Responses
- Use `sendError` and `sendErrorMessage` functions from `web-application/backend/src/utils/http-utils.ts`
- **HTTP Code:** Use semantically correct HTTP status code
- **Error Payload:** JSON response body with `error` key

## 6. Git Workflow and Commit Policy

### Commit Messages (Conventional Commits, in English)
- **Format:** `<type>(<scope>): <description>`
- **Types:** `feat`, `fix`, `docs`, `style`, `refactor`, `test`, `chore`, etc.
- **Examples:**
  - `feat(auth): add username change endpoint`
  - `fix(api): return USERNAME_IN_USE error code`

### Branching
- `main`: production-ready at all times
- `develop`: integration branch for next release
- `feature/<name>` and `fix/<name>` from `develop`
- `hotfix/<name>` from `main`

## 7. CI/CD and Tools

- **CI:** GitHub Actions runs on PRs and pushes to `develop`/`main`
- **Common Tasks:**
  - **Install:** `npm ci` (per module)
  - **Lint:** `npm run lint`
  - **Test:** `npm test`
  - **Generate API bindings:** `npm run update-api-bindings`

## 8. Configuration and Secrets

- Use environment variables and checked-in `.env.example` files
- Never commit secrets/keys/passwords
- If a secret is required, fetch from env or secret manager

## 9. Quality Checklist (pre-PR)

- [ ] Lint passes locally
- [ ] Unit/integration tests added/updated and passing
- [ ] API JSDoc updated for endpoint changes; bindings regenerated
- [ ] No `console.log` in backend; logging via Monitor
- [ ] Errors returned with proper codes and standardized payloads
- [ ] Commit messages follow Conventional Commits
- [ ] Documentation/comments updated where necessary

## 10. Security

- Never log secrets, tokens, or PII
- For crypto helpers: generate fresh IVs/nonces and prefer authenticated encryption (AEAD)
- Wrap low-level exceptions with stable, actionable messages

## 11. Language Flexibility

- **User Language Preference:** Always respond in the same language the user asks the question
- **Documentation Requests:** If user asks in Spanish for documentation in English, provide it in English as requested
- **Code Consistency:** Code comments should be in English to maintain consistency across the project
description:
globs:
alwaysApply: false
---
